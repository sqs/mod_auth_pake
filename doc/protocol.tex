\documentclass[12pt]{article}
\usepackage{savetrees}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{mathtools} % shortintertext

\begin{document}

\begin{center}
  \textsf{\textbf{\Large HTTP Tcpcrypt Auth}}
\end{center}

\section{Definitions}

\subsection*{Public}
\begin{align*}
\mathbf{G} &= \textrm{group of prime order $q$ on which CDH is hard}\\
g &= \textrm{a generator of $\mathbf{G}$} \\
U,\, V &= \textrm{chosen at random from $\mathbf{G}$} \\
H_0,\, H_1 &= \textrm{cryptographic hash functions mapping strings to elements of $\mathbf{Z}_q$} \\
H &= \textrm{hash function mapping to bit strings the size of a MAC key}
\shortintertext{\subsection*{Shared secrets (known to client and server)}}
\pi_0 &= H_0(\textrm{password}, \textrm{username}, \textrm{server name}) \\
L &= g^{\pi_1}
\shortintertext{\subsection*{Client-side secret}}
\textrm{password} \\
\pi_1 &= H_1(\textrm{password}, \textrm{username}, \textrm{server name})
\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Protocol}

\begin{tabular}{p{9cm} | p{9cm}}
\multicolumn{1}{c}{\bf Client} & \multicolumn{1}{c}{\bf Server} \\
\hline
%%%%%%%%%%%%%%%%
{\tt GET /protected} &\\

%%%%%%%%%%%%%%%%
& Randomly choose $\beta \in \mathbf{Z}_q.$

Compute $Y=g^\beta V^{\pi_0}.$

{\tt WWW-Authenticate: Tcpcrypt realm=<realm> Y=<Y hex>} \\

%%%%%%%%%%%%%%%
Choose $\alpha \in \mathbf{Z}_q$ at random.

Compute $g^\beta = g^\beta V^{\pi_0} V^{-\pi_0}.$

Compute $h = H(\pi_0,\, g^\alpha,\, g^\beta,\, g^{\alpha \beta},\, g^{\pi_1 \beta}).$

Compute ${\tt respc} = \operatorname{MAC}(h,\, {\tt TAG\_CLIENT} | sid).$

Compute $X=g^\alpha U^{\pi_0}.$

{\tt Authorization: Tcpcrypt X=<X hex> respc=<respc hex> realm=<realm> username=<username>} & \\

%%%%%%%%%%%%%%%%
& Compute $g^\alpha = g^\alpha U^{\pi_0} U^{-\pi_0}.$

Compute $g^{\pi_1 \beta} = L^\beta.$

Compute $h$.

Compute ${\tt respc}$ and check it against the value sent by $C.$ Continue only if valid.

Compute ${\tt resps} = \operatorname{MAC}(h,\, {\tt TAG\_SERVER} | sid).$

{\tt Authentication-Info: Tcpcrypt resps=<resps hex>\textbackslash n\textbackslash n <response data>} \\

%%%%%%%%%%%%%%%%
Compute ${\tt resps}$ and check it against the value sent by $S.$ If valid, display the page.
\end{tabular}


\end{document}

% Local Variables:
% tex-main-file: "protocol.tex"
% tex-dvi-view-command: "evince protocol.pdf"
% tex-command: "pdflatex protocol.tex"
% End:
