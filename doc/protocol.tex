\documentclass[10pt]{article}
\usepackage[top=0.5cm, bottom=0.5cm, left=0.5cm, right=0.5cm]{geometry}
%\usepackage{savetrees}
%\usepackage{times}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{mathtools} % shortintertext

\begin{document}

\begin{center}
  \textsf{\textbf{\Large HTTP Tcpcrypt Auth}}
  \footnote{{\tt Tcpcrypt paper}}{}
  \footnote{{\tt http://cryptobook.net/}}{}\\
  Quinn Slack, {\tt sqs@cs.stanford.edu}
\end{center}

\section{Definitions}

\begin{multicols}{2}

\subsection*{Public}
\begin{align*}
\textrm{username, realm} &: \textit{strings}\\
\mathbf{G} &: \textrm{group of prime order $q$ on which CDH is hard}\\
g &: \textrm{a generator of $\mathbf{G}$} \\
U,\, V &: \textrm{chosen at random from $\mathbf{G}$} \\
H_0,\, H_1 &: \textrm{crypto hash fn., strings $\to$ elems of $\mathbf{Z}_q$} \\
H &: \textrm{hash fn. on bit strings size of MAC key} \\
\end{align*}

\subsection*{Shared secrets (known to client and server)}
\begin{align*}
\pi_0 &= H_0(\textrm{password}, \textrm{username}, \textrm{server name}) \\
L &= g^{\pi_1}
\shortintertext{\subsection*{Client-side secret}}
\textrm{password} &: \textit{string}\\
\pi_1 &= H_1(\textrm{password}, \textrm{username}, \textrm{server name})
\end{align*}

\end{multicols}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Protocol}

\begin{tabular}{p{9.82cm} | p{9.82cm}}
\multicolumn{1}{c}{\bf Client} & \multicolumn{1}{c}{\bf Server} \\
\hline
%%%%%%%%%%%%%%%%
\vspace{0.06cm}{\tt GET /protected} \\

%%%%%%%%%%%%%%%%
& 
{\tt 401 Unauthorized}

{\tt WWW-Authenticate: Tcpcrypt realm=<realm>}
\\

%%%%%%%%%%%%%%%%

\begin{verbatim}
GET /protected
Authorization: Tcpcrypt 
               username=<username> realm=<realm>
\end{verbatim} \\

%%%%%%%%%%%%%%%%
& Choose $\beta \in \mathbf{Z}_q$ at random.

Compute $Y=g^\beta V^{\pi_0}.$

\begin{verbatim}
401 Unauthorized
WWW-Authenticate: Tcpcrypt 
                  realm=<realm>, Y=<Y>
\end{verbatim} \\

%%%%%%%%%%%%%%%
Choose $\alpha \in \mathbf{Z}_q$ at random.

Compute $g^\beta = g^\beta V^{\pi_0} V^{-\pi_0}.$

Compute $h = H(\pi_0,\, X,\, Y,\, g^{\alpha \beta},\, g^{\pi_1 \beta}).$

Compute ${\tt respc} = \operatorname{MAC}(h,\, {\tt TAG\_CLIENT} | sid).$

Compute $X=g^\alpha U^{\pi_0}.$

\begin{verbatim}
Authorization: Tcpcrypt 
               X=<X>, username=<username>,
               respc=<respc>, realm=<realm>
\end{verbatim}

& \\

%%%%%%%%%%%%%%%%
& Compute $g^\alpha = g^\alpha U^{\pi_0} U^{-\pi_0}.$

Compute $g^{\pi_1 \beta} = L^\beta.$

Compute $h$ (in the same way as the client).

Compute {\tt respc}, and continue if matches client {\tt respc}.

Compute ${\tt resps} = \operatorname{MAC}(h,\, {\tt TAG\_SERVER} | sid).$
\begin{verbatim}
200 OK
Authentication-Info: Tcpcrypt 
                     resps=<resps>

<contents of /protected>
\end{verbatim} \\

%%%%%%%%%%%%%%%%
Compute ${\tt resps}$, and show page if matches server {\tt resps}.
\end{tabular}

\end{document}

% Local Variables:
% tex-main-file: "protocol.tex"
% tex-dvi-view-command: "evince protocol.pdf"
% tex-command: "pdflatex protocol.tex"
% End:
